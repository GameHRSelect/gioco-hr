// ------- 10 DOMANDE DEFINITIVE -------
const questions = [
  { 
    q: "Come reagisci quando un’idea innovativa incontra resistenze interne?", 
    opts: [
      "Mi affido a dati e numeri per convincere", 
      "Organizzo workshop collaborativi", 
      "Adotto compromessi per avanzare"
    ], 
    vals: [8, 10, 6] 
  },
  { 
    q: "In condizioni di stress elevato, cosa fai?", 
    opts: [
      "Pianifico passo-passo", 
      "Agisco di istinto", 
      "Motivo il team emotivamente"
    ], 
    vals: [9, 7, 8] 
  },
  { 
    q: "Un collega aggira una regola per urgenza: come reagisci?", 
    opts: [
      "Applico la regola senza eccezioni", 
      "Chiedo spiegazioni e formo il collega", 
      "Rivedo il processo per eliminare il problema"
    ], 
    vals: [7, 10, 9] 
  },
  { 
    q: "Come motivi un team dopo un fallimento?", 
    opts: [
      "Analizzo errori e imposto correzioni", 
      "Conduco debrief emotivi", 
      "Propongo nuove sfide stimolanti"
    ], 
    vals: [8, 9, 10] 
  },
  { 
    q: "Quale stile di leadership prediligi?", 
    opts: [
      "Gerarchico e strutturato", 
      "Partecipativo e inclusivo", 
      "Distribuito e delegante"
    ], 
    vals: [6, 9, 10] 
  },
  { 
    q: "Come gestisci una scadenza impossibile?", 
    opts: [
      "Controllo ogni fase", 
      "Sperimentazione veloce", 
      "Chiedo supporto esterno"
    ], 
    vals: [8, 7, 10] 
  },
  { 
    q: "Quanto conta l’empatia nelle decisioni?", 
    opts: [
      "Minimamente, conta solo il risultato", 
      "Importante ma bilanciata", 
      "È centrale"
    ], 
    vals: [5, 9, 10] 
  },
  { 
    q: "Come affronti critiche ingiuste?", 
    opts: [
      "Rispondo con fatti", 
      "Accolgo il feedback e rifletto", 
      "Mantengo distacco emotivo"
    ], 
    vals: [7, 9, 8] 
  },
  { 
    q: "Bilanci creatività e budget?", 
    opts: [
      "Solo se ROI elevato", 
      "Con margini di fallback", 
      "Investimento low‑cost"
    ], 
    vals: [6, 10, 8] 
  },
  { 
    q: "Qual è la tua prima azione in un conflitto di team?", 
    opts: [
      "Mediazione neutrale", 
      "Ascolto empatico", 
      "Ridefinizione workflow"
    ], 
    vals: [8, 10, 9] 
  }
];

let idx = 0, answers = [];

// Carica la domanda
function loadQuestion() {
  const c = document.getElementById('question-container');
  c.innerHTML = '';
  if (idx < questions.length) {
    const { q, opts } = questions[idx];
    const box = document.createElement('div');
    box.className = 'question-box';
    let html = `<div class="question-text">${q}</div>`;
    opts.forEach((t,i) => {
      html += `<button class="option" onclick="choose(${i})">${t}</button>`;
    });
    box.innerHTML = html;
    c.appendChild(box);
  } else {
    showResult();
  }
}

// Gestisce la scelta e sfoca
function choose(i) {
  document.activeElement.blur();
  answers.push(questions[idx].vals[i]);
  idx++;
  loadQuestion();
}

// Analizza punteggi
function analyze(a) {
  const avg = arr => arr.reduce((x,y)=>x+y,0)/arr.length;
  return {
    leadership:   avg([a[0],a[2],a[4]]),
    empatia:      avg([a[1],a[3],a[5]]),
    adattabilita: avg([a[6],a[8]]),
    creativita:   avg([a[7],a[9]])
  };
}

// Mostra i risultati
function showResult() {
  document.getElementById('question-container').classList.add('hidden');
  const res = document.getElementById('result-box');
  res.classList.remove('hidden');
  const t = analyze(answers);
  drawCharts(t);
  fillProfile(t);
  saveHist(t);
}

// Disegna i grafici
function drawCharts(t) {
  new Chart(document.getElementById('radarChart'),{
    type:'radar',
    data:{labels:['Leadership','Empatia','Adattabilità','Creatività'],
      datasets:[{label:'Profilo',
        data:[t.leadership,t.empatia,t.adattabilita,t.creativita],
        backgroundColor:'rgba(24,99,195,0.2)',borderColor:'#1863C3'}]}
  });
  new Chart(document.getElementById('barChart'),{
    type:'bar',
    data:{labels:['Leadership','Empatia','Adattabilità','Creatività'],
      datasets:[{label:'Valori',
        data:[t.leadership,t.empatia,t.adattabilita,t.creativita],
        backgroundColor:'#8D064A'}]},
    options:{scales:{y:{beginAtZero:true,max:10}}}
  });
}

// Popola il testo
function fillProfile(t) {
  document.getElementById('profile-text').innerText = `
Leadership: ${t.leadership.toFixed(1)}/10
Empatia: ${t.empatia.toFixed(1)}/10
Adattabilità: ${t.adattabilita.toFixed(1)}/10
Creatività: ${t.creativita.toFixed(1)}/10

Equilibrio tra razionalità e sensibilità: ottimo per ambienti complessi e team diversificati.`;
}

// Salva lo storico
function saveHist(t){
  const h = JSON.parse(localStorage.getItem('hist')||'[]');
  h.push({ d:new Date().toLocaleString(), v:t });
  localStorage.setItem('hist', JSON.stringify(h));
  document.getElementById('history').innerHTML =
    '<h3>Storico</h3>'+h.map(x=>`<div class="history-item">${x.d}</div>`).join('');
}

// Restart
document.getElementById('restart').onclick = ()=>location.reload();

// Avvia
loadQuestion();
