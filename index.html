<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Psicologico Avanzato</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #F8F9FA;
            margin: 0;
            padding: 20px;
        }

        h1 {
            color: #8D064A;
        }

        .container {
            max-width: 1200px;
            margin: auto;
            display: flex;
            flex-wrap: wrap;
        }

        .left-col,
        .right-col {
            flex: 1;
            padding: 20px;
            min-width: 300px;
        }

        img {
            width: 100%;
            border-radius: 12px;
            margin-bottom: 15px;
            height: 350px;
            object-fit: cover;
        }

        .btn-option {
            width: 100%;
            margin-bottom: 10px
        }
    </style>
</head>

<body>

    <div class="container">

        <div class="left-col">
            <img id="question-img" src="" alt="Immagine Domanda">
        </div>

        <div class="right-col">
            <h1>Test Psicologico Avanzato</h1>
            <div id="question-container"></div>
            <canvas id="radarChart" style="display:none;"></canvas>
            <canvas id="barChart" style="display:none; margin-top:30px;"></canvas>
            <p id="profile-text" class="mt-4"></p>
            <button onclick="location.reload()" class="btn btn-danger mt-3">Ripeti test</button>
        </div>

    </div>

    <script>
        const questions = [
            { q: "Come affronti un dilemma etico con impatto economico?", opts: ["Analizzo tutte le variabili", "Coinvolgo il team", "Cerco equilibrio profitto-valori"], vals: [8, 7, 6], img: "https://images.unsplash.com/photo-1483389127117-b6a2102724ae" },
            { q: "Come gestisci uno stress imprevisto nel team?", opts: ["Approccio strutturato", "Empatia e ascolto", "Adattabilità rapida"], vals: [7, 9, 8], img: "https://images.unsplash.com/photo-1497366754035-f200968a6e72" },
            { q: "Decisioni rapide o meditate?", opts: ["Rapide", "Meditate", "Equilibrate"], vals: [6, 9, 8], img: "https://images.unsplash.com/photo-1519389950473-47ba0277781c" },
            { q: "Come reagisci a critiche pubbliche?", opts: ["Razionalizzo", "Accetto e miglioro", "Difendo il team"], vals: [8, 9, 7], img: "https://images.unsplash.com/photo-1543269865-cbf427effbad" },
            { q: "Gestione budget limitato?", opts: ["Ottimizzo risorse", "Creatività low-cost", "Investimento ponderato"], vals: [8, 9, 7], img: "https://images.unsplash.com/photo-1531379410502-63bfe8cdaf6f" },
            { q: "Approccio a innovazione?", opts: ["Misurata e sicura", "Sperimentale", "Prudente ma aperto"], vals: [7, 9, 8], img: "https://images.unsplash.com/photo-1552664730-d307ca884978" },
            { q: "Team conflittuale, cosa fai?", opts: ["Mediazione", "Ascolto empatico", "Ristrutturazione"], vals: [8, 9, 7], img: "https://images.unsplash.com/photo-1531538512164-e6c51ea63d20" },
            { q: "Errore grave del team, reazione?", opts: ["Analisi fredda", "Supporto emotivo", "Riorganizzo procedure"], vals: [7, 9, 8], img: "https://images.unsplash.com/photo-1565720499574-48b22a6ae256" },
            { q: "Priorità nel lavoro di squadra?", opts: ["Leadership", "Empatia", "Creatività"], vals: [8, 9, 7], img: "https://images.unsplash.com/photo-1560250056-07ba64664864" },
            { q: "Visione strategica o operativa?", opts: ["Strategica", "Operativa", "Equilibrata"], vals: [9, 7, 8], img: "https://images.unsplash.com/photo-1551836022-deb4988cc6c0" }
        ];

        let answers = [], idx = 0;

        function loadQuestion() {
            if (idx < questions.length) {
                let { q, opts, img } = questions[idx];
                document.getElementById("question-img").src = img;
                document.getElementById("question-container").innerHTML = `<h4>${q}</h4>` + opts.map((o, i) => `<button class='btn btn-primary btn-option' onclick='choose(${i})'>${o}</button>`).join('');
            } else showResult();
        }

        function choose(i) {
            answers.push(i);
            idx++;
            loadQuestion();
        }

        function showResult() {
            document.getElementById('question-container').style.display = "none";
            document.getElementById('radarChart').style.display = "block";
            document.getElementById('barChart').style.display = "block";

            let scores = { leadership: 0, empatia: 0, creativita: 0, adattabilita: 0 };
            answers.forEach((a, j) => {
                scores.leadership += questions[j].vals[a];
                scores.empatia += questions[j].vals[a] * 1.1;
                scores.creativita += questions[j].vals[a] * 1.2;
                scores.adattabilita += questions[j].vals[a] * 1.3;
            });

            new Chart("radarChart", { type: "radar", data: { labels: ["Leadership", "Empatia", "Creatività", "Adattabilità"], datasets: [{ label: "Profilo", data: Object.values(scores), backgroundColor: "rgba(29,78,216,0.2)", borderColor: "#06283F" }] } });
            new Chart("barChart", { type: "bar", data: { labels: ["Leadership", "Empatia", "Creatività", "Adattabilità"], datasets: [{ label: "Profilo", data: Object.values(scores), backgroundColor: ["#8D064A", "#06283F", "#1B65A5", "#4AAFD8"] }] } });
        }

        window.onload = loadQuestion;
    </script>

</body>

</html>
// CONTINUAZIONE E ARRICCHIMENTO CODICE PRECEDENTE (200 RIGHE)

// Funzione animazione transizioni tra domande
function animateTransition(container) {
  container.style.opacity = '0';
  container.style.transform = 'translateY(20px)';
  setTimeout(() => {
    container.style.opacity = '1';
    container.style.transform = 'translateY(0)';
  }, 300);
}

// Gestione transizioni con listener
function setupTransitions() {
  const questionContainer = document.getElementById('question-container');
  const options = questionContainer.querySelectorAll('.option-btn');

  options.forEach(btn => {
    btn.addEventListener('click', () => animateTransition(questionContainer));
  });
}

// Funzione per resettare animazioni a fine quiz
function resetAnimations() {
  const container = document.getElementById('result-box');
  container.style.opacity = '0';
  setTimeout(() => {
    container.style.opacity = '1';
  }, 500);
}

// Inizializza animazioni al caricamento pagina
window.onload = setupTransitions;

// Funzione feedback dinamico sui punteggi
function generateDynamicFeedback(scores) {
  const feedback = document.getElementById('dynamic-feedback');
  let text = '';

  if(scores.leadership > 8) {
    text += "Hai eccellenti capacità di leadership e riesci sempre a guidare il tuo team verso gli obiettivi. ";
  } else if(scores.leadership > 5) {
    text += "La tua leadership è equilibrata e collaborativa, con margini di miglioramento nella decisionalità. ";
  } else {
    text += "Potresti lavorare sulla tua assertività e capacità decisionale. ";
  }

  if(scores.empatia > 8) {
    text += "La tua empatia è straordinaria, sai sempre leggere e rispondere alle emozioni altrui. ";
  } else if(scores.empatia > 5) {
    text += "Hai una buona empatia, anche se a volte fatichi a gestire situazioni ad alta tensione emotiva. ";
  } else {
    text += "L'empatia è un'area da sviluppare per migliorare le relazioni interpersonali. ";
  }

  feedback.textContent = text;
}

// Aggiorna profilo psicologico con feedback dinamico
function updateProfileWithFeedback(t) {
  generateDynamicFeedback({
    leadership: t.leadership,
    empatia: t.empatia
  });
}

// Funzione per mostrare statistiche globali
function showGlobalStats() {
  const statsBox = document.getElementById('global-stats');
  const stats = JSON.parse(localStorage.getItem('globalStats')) || [];

  if (stats.length === 0) {
    statsBox.textContent = 'Nessun dato statistico globale disponibile.';
    return;
  }

  let leadershipAvg = stats.reduce((a,b)=>a+b.leadership,0)/stats.length;
  let empatiaAvg = stats.reduce((a,b)=>a+b.empatia,0)/stats.length;

  statsBox.innerHTML = `
    <h4>Statistiche Globali degli Utenti:</h4>
    <p>Leadership media: ${leadershipAvg.toFixed(1)}</p>
    <p>Empatia media: ${empatiaAvg.toFixed(1)}</p>
  `;
}

// Aggiorna statistiche globali con nuovo risultato
function updateGlobalStats(newResult) {
  const stats = JSON.parse(localStorage.getItem('globalStats')) || [];
  stats.push(newResult);
  localStorage.setItem('globalStats', JSON.stringify(stats));
  showGlobalStats();
}

// Inizializza statistiche globali all'avvio
window.onload = showGlobalStats;

// Funzione toggle modalità dark/light
function toggleDarkMode() {
  const body = document.body;
  body.classList.toggle('dark-mode');
  localStorage.setItem('darkMode', body.classList.contains('dark-mode'));
}

// Setup modalità tema alla partenza
function setupTheme() {
  if(localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark-mode');
  }

  const toggleBtn = document.getElementById('theme-toggle-btn');
  toggleBtn.addEventListener('click', toggleDarkMode);
}

window.onload = setupTheme;

// Funzione aiuto tooltip per domande difficili
function setupTooltips() {
  const tooltips = document.querySelectorAll('.tooltip');

  tooltips.forEach(tooltip => {
    tooltip.addEventListener('mouseover', () => {
      const tooltipText = document.createElement('span');
      tooltipText.className = 'tooltip-text';
      tooltipText.textContent = tooltip.getAttribute('data-tooltip');
      tooltip.appendChild(tooltipText);
    });

    tooltip.addEventListener('mouseout', () => {
      tooltip.removeChild(tooltip.querySelector('.tooltip-text'));
    });
  });
}

window.onload = setupTooltips;

// Aggiunta opzioni per condividere il risultato
function setupShareOptions() {
  const shareBtn = document.getElementById('share-result-btn');
  shareBtn.onclick = () => {
    const text = encodeURIComponent("Guarda il mio profilo psicologico generato da questo test avanzato!");
    const url = encodeURIComponent(window.location.href);

    window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}&text=${text}`, '_blank');
  };
}

window.onload = setupShareOptions;

// Notifica di completamento
function notifyCompletion() {
  if(Notification.permission === "granted") {
    new Notification("Complimenti!", { body: "Hai completato il test psicologico avanzato!" });
  } else if(Notification.permission !== "denied") {
    Notification.requestPermission().then(permission => {
      if(permission === "granted") notifyCompletion();
    });
  }
}

// Trigger notifica a fine test
function showResultAndNotify(){
  showResult();
  notifyCompletion();
}

// Finalizzazione del risultato con tutte le nuove funzioni integrate
function finalizeResult(t){
  updateProfileWithFeedback(t);
  updateGlobalStats(t);
  resetAnimations();
  showResultAndNotify();
}

// Integrazione al flusso finale
function showResult(){
  const t = analyze(answers);
  drawCharts(t);
  fillProfile(t);
  finalizeResult(t);
}
